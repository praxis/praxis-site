"use strict";(self.webpackChunkpraxis_site=self.webpackChunkpraxis_site||[]).push([[6322],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>m});var i=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},a=Object.keys(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var p=i.createContext({}),s=function(e){var t=i.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},u=function(e){var t=s(e.components);return i.createElement(p.Provider,{value:t},e.children)},c="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},f=i.forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,p=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),c=s(n),f=r,m=c["".concat(p,".").concat(f)]||c[f]||d[f]||a;return n?i.createElement(m,o(o({ref:t},u),{},{components:n})):i.createElement(m,o({ref:t},u))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,o=new Array(a);o[0]=f;var l={};for(var p in t)hasOwnProperty.call(t,p)&&(l[p]=t[p]);l.originalType=e,l[c]="string"==typeof e?e:r,o[1]=l;for(var s=2;s<a;s++)o[s]=n[s];return i.createElement.apply(null,o)}return i.createElement.apply(null,n)}f.displayName="MDXCreateElement"},7514:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>o,default:()=>d,frontMatter:()=>a,metadata:()=>l,toc:()=>s});var i=n(7462),r=(n(7294),n(3905));const a={title:"Mapper Plugin"},o=void 0,l={unversionedId:"reference/extensions/mapper-plugin",id:"reference/extensions/mapper-plugin",title:"Mapper Plugin",description:"The MapperPlugin plugin is a 'meta'-extension that will configure several of the common feature extensions to work together with minimal effort.",source:"@site/docs/reference/extensions/mapper-plugin.md",sourceDirName:"reference/extensions",slug:"/reference/extensions/mapper-plugin",permalink:"/docs/reference/extensions/mapper-plugin",draft:!1,tags:[],version:"current",frontMatter:{title:"Mapper Plugin"},sidebar:"mainSidebar",previous:{title:"Introduction",permalink:"/docs/reference/extensions/intro"},next:{title:"Pagination Plugin",permalink:"/docs/reference/extensions/pagination-plugin"}},p={},s=[{value:"Configuration",id:"configuration",level:2}],u={toc:s},c="wrapper";function d(e){let{components:t,...n}=e;return(0,r.kt)(c,(0,i.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"MapperPlugin")," plugin is a 'meta'-extension that will configure several of the common feature extensions to work together with minimal effort."),(0,r.kt)("p",null,"In particular, configuring this plugin will configure all of your Controllers to bring in the Rendering, FieldSelection, FieldExpansion and SelectorGeneration extensions."),(0,r.kt)("p",null,"These combined, equip your application to:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"accept GraphQL-type field selection as an API parameter"),(0,r.kt)("li",{parentName:"ul"},"accept a powerful language for filtering results"),(0,r.kt)("li",{parentName:"ul"},"automatically use the common functions to provide the necessary efficent DB queries to retrieve and filter the data"),(0,r.kt)("li",{parentName:"ul"},"seamlessly render the resulting data to match the desired client fields")),(0,r.kt)("p",null,"Not bad!"),(0,r.kt)("p",null,"You can find more information on each of these features in their respective extension pages, but in a nutshell, the ",(0,r.kt)("inlineCode",{parentName:"p"},"MapperPlugin")," allows you to do things like this."),(0,r.kt)("p",null,"In the endpoint definition, you can easy enable field_selection and define which filters you accept:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ruby"},"  params do\n    attribute :fields, Praxis::Types::FieldSelector.for(MediaTypes::Post),\n              description: 'Fields with which to render the result.'\n    attribute :filters, Praxis::Types::FilteringParams.for(MediaTypes::Post) do\n              filter 'title', using: ['=', '!='], fuzzy: true\n              filter 'author.email', using: ['=', '!=']\n              filter 'author.id', using: ['=', '!=']\n    end\n  end\n")),(0,r.kt)("p",null,"In your Resource business logic, you can define how these API filter names might map differently to the lower level DB columns of your data:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ruby"},"    filters_mapping(\n      'title': 'title',\n      'author.email': 'author.email',\n      'author.id': 'author_id',\n    )\n")),(0,r.kt)("p",null,"And then finally, in your Controllers you can easily invoke the ",(0,r.kt)("inlineCode",{parentName:"p"},"build_query")," to make the system craft the right set of DB queries, and the ",(0,r.kt)("inlineCode",{parentName:"p"},"display")," method to render the retrieved resources, into the right media type subattribute trees that the client wants. Here's how the ",(0,r.kt)("inlineCode",{parentName:"p"},"index")," action for retrieving posts could look like:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ruby"},"  def index\n    objects = build_query(::Post).all\n    display(objects)\n  end\n")),(0,r.kt)("p",null,"So, in essence that's the meta functionality you get by simply requiring the plugin when your application boots, and telling Praxis to use it:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ruby"},"require 'praxis/plugins/mapper_plugin'\n\nPraxis::Application.configure do |application|\n  # Use the Mapper plugin\n  application.bootloader.use Praxis::Plugins::MapperPlugin\n  ...\n\n")),(0,r.kt)("p",null,"This alone brings in all the functionality above, but requiring classes like ",(0,r.kt)("inlineCode",{parentName:"p"},"FieldSelector"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"FilteringParams"),", exposing the ",(0,r.kt)("inlineCode",{parentName:"p"},"display")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"build_query")," methods in the controller, intercepting and mapping API filters into extra join DB statement, and being able to preload and join the necessary related tables to retrieve the required fields in an efficient way."),(0,r.kt)("p",null,"As a note, this plugin does not include pagination and sorting extensions, which are easily available through the ",(0,r.kt)("inlineCode",{parentName:"p"},"PaginationPlugin")),(0,r.kt)("h2",{id:"configuration"},"Configuration"),(0,r.kt)("p",null,"The Mapper plugin currently accepts only 1 configuration option: ",(0,r.kt)("inlineCode",{parentName:"p"},"debug_queries"),". Like any other plugin, you can set it up under the ",(0,r.kt)("inlineCode",{parentName:"p"},"application.config")," subtree. For example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ruby"},"Praxis::Application.configure do |application|\n  ...\n  application.config.mapper.debug_queries = true\n")),(0,r.kt)("p",null,"When ",(0,r.kt)("inlineCode",{parentName:"p"},"debug_queries")," is set to true, the system will output information about the expanded fields and associations that the system has calculated necessary to pull from the DB, based on the requested API fields, API filters and ",(0,r.kt)("inlineCode",{parentName:"p"},"property")," dependencies defined in the domain models (i.e., resources)"))}d.isMDXComponent=!0}}]);