<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Praxis Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Praxis Blog Atom Feed"><title data-react-helmet="true">Filtering | Praxis</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Filtering | Praxis"><meta data-react-helmet="true" name="description" content="The filtering extensions, along with the field selection and the automatic DB querying is a powerful tool that makes it trivial for API clients to slice and dice what data to retrieve."><meta data-react-helmet="true" property="og:description" content="The filtering extensions, along with the field selection and the automatic DB querying is a powerful tool that makes it trivial for API clients to slice and dice what data to retrieve."><meta data-react-helmet="true" property="og:url" content="https://www.praxis-framework.io/docs/reference/extensions/filtering"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://www.praxis-framework.io/docs/reference/extensions/filtering"><link rel="stylesheet" href="/styles.ab2c79ee.css">
<link rel="preload" href="/styles.27a80096.js" as="script">
<link rel="preload" href="/runtime~main.d759ace7.js" as="script">
<link rel="preload" href="/main.0f7e767c.js" as="script">
<link rel="preload" href="/1.1d955ac3.js" as="script">
<link rel="preload" href="/65.fc2dba12.js" as="script">
<link rel="preload" href="/66.81df1f16.js" as="script">
<link rel="preload" href="/935f2afb.f1e5e5bf.js" as="script">
<link rel="preload" href="/64.4c9a6482.js" as="script">
<link rel="preload" href="/e6a3b3de.2ae39c0b.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="Praxis Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/logo.png" alt="Praxis Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Praxis</strong></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/gettingStarted/intro">Getting Started</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/reference/intro">Reference</a><a href="https://github.com/praxis/praxis" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="Praxis Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/logo.png" alt="Praxis Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Praxis</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/gettingStarted/intro">Getting Started</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/reference/intro">Reference</a></li><li class="menu__list-item"><a href="https://github.com/praxis/praxis" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><div class="docSidebarContainer_3Ak5" role="complementary"><div class="sidebar_3gvy"><div class="menu menu--responsive thin-scrollbar menu_1yIk"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_1CUI" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Intro</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/intro/intro">Intro</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/intro/installation">Installation</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Getting Started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/gettingStarted/intro">Intro</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/gettingStarted/designingApiResources">Designing our API resources</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/gettingStarted/settingUpOurDB">Setting Up Our Database</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/gettingStarted/implementingReads">Implementing Reads</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/gettingStarted/buildingCRUD">Building CRUD</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Reference</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/intro">Introduction</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Design</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/reference/design/media-types">Media Types</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/reference/design/endpoints">Endpoints</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/reference/design/actions">Actions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/reference/design/api-definition">General API Definitions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/reference/design/response-definitions">Responses</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/reference/design/traits">Traits</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/reference/design/doc-generation">Document Generation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/reference/design/multipart">Multipart</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Implementation</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/reference/implementation/controllers">Controllers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/reference/implementation/application">Application</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/reference/implementation/responses">Responses</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/reference/implementation/request-life-cycle">Request Life Cycle</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/reference/implementation/multipart">Multipart Types</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!" tabindex="0">Extensions</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/extensions/intro">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/extensions/mapper-plugin">Mapper Plugin</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/extensions/pagination-plugin">Pagination Plugin</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/extensions/field-selection">Field Selection</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/reference/extensions/filtering">Filtering</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/extensions/rendering">Rendering</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Internals</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/reference/internals/intro">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/reference/internals/field_selection">FieldSelection</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/reference/internals/field_expansion">FieldExpansion</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/reference/internals/mapper_selectors">MapperSelectors</a></li></ul></li></ul></li></ul></div><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_2WRA"><svg width="20" height="20" role="img" class="collapseSidebarButtonIcon_CoMu"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">Filtering</h1></header><div class="markdown"><p>The filtering extensions, along with the field selection and the automatic DB querying is a powerful tool that makes it trivial for API clients to slice and dice what data to retrieve.</p><p>To take advantage of this extension you just need to do two things. First add which attributes you want to allow to filter by in your action design, and second, provide the mapping from these filter names, to the names of the underlying associations and/or database columns. Let&#x27;s take a look at what this means before we get into the details.</p><p>Let&#x27;s assume you want to allow to filter your <code>Posts</code> by their <code>title</code>, or by their author&#x27;s <code>email</code> or by the date is was <code>posted_at</code>. To do so, you&#x27;d define a <code>filters</code> param (typically in the <code>index</code> action) much like this:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-ruby codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  params do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    attribute :filters, Praxis::Types::FilteringParams.for(MediaTypes::Post) do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              filter &#x27;title&#x27;, using: [&#x27;=&#x27;, &#x27;!=&#x27;], fuzzy: true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              filter &#x27;author.email&#x27;, using: [&#x27;=&#x27;, &#x27;!=&#x27;]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              filter &#x27;posted_at&#x27;, using: [&#x27;=&#x27;, &#x27;!=&#x27;,&#x27;&gt;&#x27;,&#x27;&lt;&#x27;,&#x27;&gt;=&#x27;,&#x27;=&lt;&#x27;]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Note that we&#x27;ve made some decisions here, about restricting which operators we allow for each filter, including deciding that we can allow the client for filter by prefix/postfix on the title (i.e., a <code>LIKE</code> or <code>REGEXP</code>-type condition).</p><p>In your Resource business logic, you also have to define how these API filter names might map differently to the lower level DB columns of your data. In this case, we can see that the <code>title</code> and <code>posted_at</code> filters map to the same column names. We can also see that we need to map the author&#x27;s email filter, to an underlying <code>user</code> association, and a <code>email_address</code> column. In other words, the mapping can traverse associations and/or map to names of columns that might or might not coincide with the filter names used. For simplicity, Praxis allows you to omit mapping simple names that concide (so we could have perfectly omitted <code>title</code> and <code>posted_at</code> in this example.) Note that omission is for &#x27;simple&#x27; fields, you still need to define mappings for any nested field even if they both map to the same(i.e., &#x27;user.id&#x27; =&gt; &#x27;user.id&#x27; still needs to defined ).</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-ruby codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">    filters_mapping(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &#x27;title&#x27;: &#x27;title&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &#x27;author.email&#x27;: &#x27;user.email_address&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &#x27;posted_at&#x27;: &#x27;posted_at&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    )</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="filteringparams-type"></a>FilteringParams type<a class="hash-link" href="#filteringparams-type" title="Direct link to heading">#</a></h2><p>Every filter defined in the Filtering params type can declare:</p><ul><li>the exposed name of the filter</li><li>the operators that are allowed to use</li><li>and if they can be used to do prefix/suffix matching.</li></ul><p>When you use the <code>.for</code> method of the <code>FilteringParams</code> type, the defined filter names must correspond to fields of the mediatype. These names can recurse down into other related fields of the mediatypes, all the way down to the final condition. In other words, filtering is not restricted to a direct attribute, or a single nested level. The only way to provide filter names that do not map to the mediatype would be to use the <code>FilteringParams</code> type without the <code>.for</code> method, and properly build your parsing and coercion of attributes.</p><p>There are 8 available operators to choose from: <code>=</code>, <code>&lt;</code>, <code>&gt;</code>,<code>!=</code>, <code>&gt;=</code>, <code>&lt;=</code>, <code>!</code>,<code>!!</code>. The first 6 are seemingly self explanatory and always take a value (i.e., <code>filter_name&gt;value</code>). The last 2 operators are for checking NULL (or NOT NULL) values and do not accept a value. In particular:</p><ul><li><code>filter_name!</code> would filter results whose <code>filter_name is NOT NULL</code></li><li><code>filter_name!!</code> would filter results whose <code>filter_name is NULL</code></li></ul><p>Something important to point out, is that the filtering framework also allows to place conditions on associations directly (instead of leaf attributes). This powerful feature (only available for the <code>!</code> and <code>!!</code> operators) allows filtering results where full collections of related objects are empty, or are not empty. For example:</p><ul><li><code>author!</code> would return only Posts which have associated authors.</li><li><code>comments!!</code> would return only Posts which have no associated comments</li></ul><p>Filters for string attributes, can also accept a <code>fuzzy: true</code> option, which would allow to prefix or postfix patch the value. For example, using our <code>title</code> filter above would allow us to do things like this:</p><ul><li><code>title=*ending</code>, which will translate to a SQL query similar to <code>LIKE &quot;%ending&quot;</code></li><li><code>title=starting*</code>, which will translate to a SQL query similar to <code>LIKE &quot;starting%&quot;</code></li><li><code>title=*Iam%20a%2A%21</code> (whose encoded value after the <code>*</code> is <code>Iam a*!</code>) which will translate to a SQL query similar to <code>LIKE &quot;%Iam a*!&quot;</code></li></ul><p>A filter condition generally has a single value, but Praxis allows you to pass a comma-separated list of values as a compact way to do a multimatch without requiring several clauses. These will generally be translated to <code>IN clause</code> SQL queries. Here is an example some examples:</p><ul><li><code>author.email=one%40example.com,two%40example.com</code>, which will typically translate into <code>... email_address IN (&#x27;one@example.com&#x27;, &#x27;one@example.com)</code></li></ul><p>Remember that we need to always escape the filter values. This multi-map case is no different, so we will do so for each of them but not the &quot;commas&quot; as that&#x27;s part of the filter syntax. Also note that all of the resulting string of the <code>filters</code> value will also be url-encoded when forming the query string of the API request.</p><p>The syntax allows you to to combine multiple filter conditions in the same API call. In fact, it is possible to combine them with <code>AND</code>, <code>OR</code> operands, as well as group them with parenthesis. The precedence of operands is exactly what you&#x27;d expect, where <code>AND</code> has higher-precedence than <code>OR</code> unless there are parenthesized groups defining an element.</p><ul><li><code>&amp;</code> is used to <code>AND</code> two filters and/or expressions. For example: <code>title=one&amp;posted_at&gt;2000-01-01</code></li><li><code>|</code> is used to <code>OR</code> two filters and/or expressions. For example: <code>title=one|author.email=email1</code></li><li><code>(</code> and <code>)</code> are used to group one or more filter conditions. For example: <code>(a=1|b=2)&amp;c=3&amp;d=4</code></li></ul><p>Not to repeat ourselves too much, but obviously do not escape these symbols when used in this mode. Only escape them when they are part of a value.</p></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/reference/extensions/field-selection"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Field Selection</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/reference/extensions/rendering"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Rendering Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#filteringparams-type" class="table-of-contents__link">FilteringParams type</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow</a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog/">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/styles.27a80096.js"></script>
<script src="/runtime~main.d759ace7.js"></script>
<script src="/main.0f7e767c.js"></script>
<script src="/1.1d955ac3.js"></script>
<script src="/65.fc2dba12.js"></script>
<script src="/66.81df1f16.js"></script>
<script src="/935f2afb.f1e5e5bf.js"></script>
<script src="/64.4c9a6482.js"></script>
<script src="/e6a3b3de.2ae39c0b.js"></script>
</body>
</html>