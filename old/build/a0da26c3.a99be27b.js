(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{102:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return r})),t.d(n,"metadata",(function(){return s})),t.d(n,"toc",(function(){return p})),t.d(n,"default",(function(){return c}));var a=t(3),i=t(7),o=(t(0),t(133)),r={title:"Responses"},s={unversionedId:"reference/design/response-definitions",id:"reference/design/response-definitions",isDocsHomePage:!1,title:"Responses",description:"Praxis allows API designers to define the set of response templates the",source:"@site/docs/reference/design/response-definitions.md",slug:"/reference/design/response-definitions",permalink:"/docs/reference/design/response-definitions",version:"current",sidebar:"mainSidebar",previous:{title:"General API Definitions",permalink:"/docs/reference/design/api-definition"},next:{title:"Traits",permalink:"/docs/reference/design/traits"}},p=[{value:"Preregistered Responses",id:"preregistered-responses",children:[]},{value:"Defining Response Expectations",id:"defining-response-expectations",children:[{value:"Headers",id:"headers",children:[]},{value:"MediaType",id:"mediatype",children:[]},{value:"Location",id:"location",children:[]},{value:"Multipart responses",id:"multipart-responses",children:[]}]}],l={toc:p};function c(e){var n=e.components,t=Object(i.a)(e,["components"]);return Object(o.b)("wrapper",Object(a.a)({},l,t,{components:n,mdxType:"MDXLayout"}),Object(o.b)("p",null,"Praxis allows API designers to define the set of response templates the\napplication can return. By designing a response, you are describing a set of\nexpectations about its structure and attributes. You then give it a name and\ntell Praxis about it using ",Object(o.b)("inlineCode",{parentName:"p"},"response_template"),"."),Object(o.b)("p",null,"Here is an example of how to design a response definition:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ruby"}),"ApiDefinition.define do\n  response_template :ok do\n    description 'An ok response refers to a successful outcome'\n    status 200\n    media_type 'application/vnd.acme.user'\n    headers name: 'X-Header1', value: 'foo', description: 'This is a very nais header, which has value foo'\n    headers name: 'X-Header2', value: /bar/, description: 'This header contains the bar string'\n    headers name: 'X-Some-Stuff', value: nil, description: 'This only requires the header to exist, with any value'\n  end\nend\n")),Object(o.b)("p",null,"This creates a response definition named ",Object(o.b)("inlineCode",{parentName:"p"},"ok")," with a human-readable description which will be rendered in the API documentation. With this we are declaring that this response will:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"have a status code of 200"),Object(o.b)("li",{parentName:"ul"},"return an ",Object(o.b)("inlineCode",{parentName:"li"},"application/vnd.acme.user")," media type (the value of the Content-Type header)"),Object(o.b)("li",{parentName:"ul"},"contain, at least, the following two headers:",Object(o.b)("ul",{parentName:"li"},Object(o.b)("li",{parentName:"ul"},Object(o.b)("inlineCode",{parentName:"li"},"X-Header1"),' which must always match a literal value "foo"'),Object(o.b)("li",{parentName:"ul"},Object(o.b)("inlineCode",{parentName:"li"},"X-Header2")," which must always match the regular expression ",Object(o.b)("inlineCode",{parentName:"li"},"/bar/")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("inlineCode",{parentName:"li"},"X-Some-Stuff")," which can have any value")))),Object(o.b)("p",null,"Any action may refer to a response by name when declaring its list of expected\nresponses. For example, here is a snippet of an action describing\nthat it can return the ",Object(o.b)("inlineCode",{parentName:"p"},"ok")," response defined above."),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ruby"}),"# somewhere in a resource definition...\naction :index do\n  routing { get '' }\n  response :ok\nend\n")),Object(o.b)("p",null,"See ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"../resource-definitions/"}),"ActionDefinitions")," for more information about\nhow to specify which responses an action can return."),Object(o.b)("p",null,"Having response templates that have all fields statically defined like our example above, make it more difficult to reuse accross actions. For example, you may want to use the ",Object(o.b)("inlineCode",{parentName:"p"},"ok")," definition above for an action that returns an a media-type other than ",Object(o.b)("inlineCode",{parentName:"p"},"application/vnd.acme.user"),"."),Object(o.b)("p",null,"For this reason, response definitons are parameterizable via block parameters.\nFor example, introducing a ",Object(o.b)("inlineCode",{parentName:"p"},"media_type")," parameter in our previous ",Object(o.b)("inlineCode",{parentName:"p"},"ok")," response\ncould be done like this:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ruby"}),"ApiDefinition.define do\n  response_template :ok do |media_type: 'application/vnd.acme.user'|\n    description 'An ok response refers to a successful outcome'\n    status 200\n    media_type media_type\n    headers name: 'X-Header1', value: 'foo', description: 'This is a very nais header, which has value foo'\n    headers name: 'X-Header2', value: /bar/, description: 'This header contains the bar string'\n    headers name: 'X-Some-Stuff', value: nil, description: 'This only requires the header to exist, with any value'\n  end\nend\n")),Object(o.b)("p",null,"Parameterized responses allow you to reuse registered responses in action definitions with some flexibility:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ruby"}),"# somewhere in a resource definition...\naction :index do\n  routing { get '' }\n  response :ok, media_type: 'application/custom'\nend\n")),Object(o.b)("p",null,"This example response definition has not just a ",Object(o.b)("inlineCode",{parentName:"p"},"media_type")," parameter but\nalso a default value of 'application/json'.  This allows you to override the\n",Object(o.b)("inlineCode",{parentName:"p"},"media_type")," only when necessary. If you don't specify the ",Object(o.b)("inlineCode",{parentName:"p"},"media_type"),",\nyou'll get ",Object(o.b)("inlineCode",{parentName:"p"},"application/json"),". If you don't specify a default, you will have to\nexplicitly pass a value in every action that uses this response definition."),Object(o.b)("h2",{id:"preregistered-responses"},"Preregistered Responses"),Object(o.b)("p",null,"Praxis comes with many common response definitions pre-registered. All of them\nalso have customizable parameters. Here is how the basic ",Object(o.b)("inlineCode",{parentName:"p"},"200 Ok")," response is defined. Note that one can add or override not just the mediatype but also, the location, any header expectations and even the description."),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ruby"}),'response_template :ok do |media_type: nil, location: nil, headers: nil, description: nil|\n  status 200\n  description( description || base_description ) # description can "potentially" be overriden in an individual action.\n\n  media_type media_type if media_type\n  location location if location\n  headers&.each do |(name, value)|\n    header(name: name, value: value)\n  end\nend\n')),Object(o.b)("p",null,"And there are many others. In particular, Praxis automatically creates a\nresponse definition for every Response class in\n",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/praxis/praxis/blob/master/lib/praxis/responses/http.rb"}),"responses/http.rb"),".\nEach of those definitions will have the name and status code specified in the\n",Object(o.b)("inlineCode",{parentName:"p"},"self.response_name")," and ",Object(o.b)("inlineCode",{parentName:"p"},"self.status")," of those classes."),Object(o.b)("p",null,"You can use any of these response definitions within your application without\nhaving to register them yourself. You can also override any of them with your\nown definition if the default one does not suit your needs."),Object(o.b)("h2",{id:"defining-response-expectations"},"Defining Response Expectations"),Object(o.b)("p",null,"When defining a response, you may include expectations for: status code,\nheaders, location, media_type and multipart parts."),Object(o.b)("p",null,"All expectations in definitions are optional and potentially parameterizable\nwith the exception of status code. A status code must always be defined and set\nstatically. It is possible for multiple responses to share the same status code\nas they might differ in other expectations (i.e. different headers) which may\nbe enough to warrant a different name."),Object(o.b)("h3",{id:"headers"},"Headers"),Object(o.b)("p",null,"The ",Object(o.b)("inlineCode",{parentName:"p"},"header")," DSL in a response definition is how we can define expectations on the returned headers of a response. There are three types of expectations we can define:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"Expecting to see a header with a given name, without specifying anything about its value."),Object(o.b)("li",{parentName:"ul"},"Expecting to see a header with a given name, specifying that its contents will have a literal match to a specific value."),Object(o.b)("li",{parentName:"ul"},"Expecting to see a header with a given name, specifying that its contents will match a given regular expression.")),Object(o.b)("p",null,"Here's an example of each type of header definition:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ruby"}),"ApiDefinition.define do\n  # header field set with a String\n  response_template :found do\n    status 200\n    headers name: 'X-Header1', value: 'foo', description: 'This is a very nais header, which has value foo'\n    headers name: 'X-Header2', value: /bar/, description: 'This header contains the bar string'\n    headers name: 'X-Some-Stuff', value: nil, description: 'This only requires the header to exist, with any value'\n  end\n")),Object(o.b)("h3",{id:"mediatype"},"MediaType"),Object(o.b)("p",null,"Use the ",Object(o.b)("inlineCode",{parentName:"p"},"media_type")," method to set expectations for the media type of a response. The ",Object(o.b)("inlineCode",{parentName:"p"},"media_type")," method can accept:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"a string indicating the full Internet media type identifier"),Object(o.b)("li",{parentName:"ul"},"a complete Praxis MediaType class")),Object(o.b)("p",null,"For example:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ruby"}),"# Praxis media_type\nclass ExampleMediaType < Praxis::MediaType\nend\n\nApiDefinition.define do\n  # String media_type\n  response_template :found do\n    status 200\n    media_type 'application/json'\n  end\n\n  # Praxis::MediaType\n  response_template :found do\n    status 200\n    media_type ExampleMediaType\n  end\n\n  # Media type passed in via a required named parameter\n  response_template :found do |media_type: |\n    status 200\n    media_type media_type\n  end\nend\n")),Object(o.b)("p",null,"Using a string for the media-type is equivalent to defining the 'Content-Type'\nheader with a string value. The reason for providing a media-type DSL is just a\nconvenience since (just like ",Object(o.b)("inlineCode",{parentName:"p"},"Location"),") it is a common header to use."),Object(o.b)("h3",{id:"location"},"Location"),Object(o.b)("p",null,"A response definition can directly define a 'Location' header using the\n",Object(o.b)("inlineCode",{parentName:"p"},"location")," method. This method can accept the same value matchers as any other\nheaders. In fact, underneath, the location method will call the ",Object(o.b)("inlineCode",{parentName:"p"},"header")," with ",Object(o.b)("inlineCode",{parentName:"p"},"name: 'Location'"),". As such, it can also take a description"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ruby"}),"ApiDefinition.define do\n  response_template :redirection do\n    status 302\n    location 'http://www.example.com', description: 'Response to redirect you home'\n  end\n\n  response_template :created do\n    status 202\n    location /api/\n  end\nend\n")),Object(o.b)("h3",{id:"multipart-responses"},"Multipart responses"),Object(o.b)("p",null,"TODO!! Should we get rid and/or simplify multipart responses????"),Object(o.b)("p",null,"Praxis also allows you to define that a given response will be of multipart type. Not only that, but it also allows to define expectations on the individual parts of the multipart response. You can do this by using the ",Object(o.b)("inlineCode",{parentName:"p"},"parts")," DSL."),Object(o.b)("p",null,"Currently, the ",Object(o.b)("inlineCode",{parentName:"p"},"parts")," DSL only allows you to define a common template\ndefinition to which ",Object(o.b)("em",{parentName:"p"},"all")," parts must comply. In the future, we will extend the\nDSL to allow you to define different expectations for each individual part."),Object(o.b)("p",null,"The DSL lets you define parts as if they were complete\nsub-requests. This can be done in either of the following ways:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"pass a block with a full response definition. This allows you to define a\npart inline, as if it were a new and complete sub-request."),Object(o.b)("li",{parentName:"ul"},"pass a ",Object(o.b)("inlineCode",{parentName:"li"},"like")," parameter which names an existing response definition")),Object(o.b)("p",null,"Since a multipart part does not have a status code, Praxis will enforce the\nexpectation by looking at the value of a special 'Status' header. The rest of\nthe fields (headers, location and media_type) are native fields of the part."),Object(o.b)("p",null,"Here are two examples of how to add part expectations using both of these\napproaches. Using a response block:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ruby"}),"ApiDefinition.define do\n  response_template :bulk_create do\n    status 200\n    media_type 'multipart/form-data'\n    parts do\n      status 201\n      media_type 'application/json'\n      location  /my_resource/\n    end\n  end\nend\n")),Object(o.b)("p",null,"Using the ",Object(o.b)("inlineCode",{parentName:"p"},":like")," option:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ruby"}),"ApiDefinition.define do\n  response_template :bulk_create do\n    status 200\n    media_type 'multipart/form-data'\n    parts like: :create\n  end\nend\n")),Object(o.b)("p",null,"Obviously, good reuse of these definitions requires parameterization, so a more\nrealistic definition of a multipart response could look like this:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ruby"}),"ApiDefinition.define do\n  response_template :bulk_response do |parts: |\n    status 200\n    media_type 'multipart/form-data'\n    parts( parts )\n  end\nend\n")),Object(o.b)("p",null,"You could allow an action to customize parts using the ",Object(o.b)("inlineCode",{parentName:"p"},"like")," option or by\npassing a full response definition block. Here are some more examples:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ruby"}),"# Using the :like option for parts like the :ok response\naction :bulk_operation do\n  routing { post '/bulk' }\n  response :bulk_response, parts: { like: :ok }\nend\n\n# Using the :like option for parts like the :ok response, but also overriding\n# the media-type of the :ok response\naction :bulk_operation do\n  routing { post '/bulk' }\n  response :bulk_response, parts: {\n    like: :ok,\n    media_type: ExampleMediaType\n  }\nend\n\n# Using a full response block definition\naction :bulk_operation do\n  routing { post '/bulk' }\n  sub_request = proc do\n    status 200\n    media_type ExampleMediaType\n    headers ['X-Foo','X-Bar']\n  end\n  response :bulk_response, parts: sub_request\nend\n")),Object(o.b)("p",null,"The only reason to not pass the block directly in the response line is that\nRuby would never pass it to the ",Object(o.b)("inlineCode",{parentName:"p"},"parts")," parameter, but rather to the response\nfunction. Splitting into a different line to create a ",Object(o.b)("inlineCode",{parentName:"p"},"proc")," looks cleaner than\nadding the right parenthesis in one line."),Object(o.b)("p",null,"For more information on multipart responses, please see\n",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"../responses/"}),"Responses"),"."))}c.isMDXComponent=!0},133:function(e,n,t){"use strict";t.d(n,"a",(function(){return d})),t.d(n,"b",(function(){return m}));var a=t(0),i=t.n(a);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function s(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function p(e,n){if(null==e)return{};var t,a,i=function(e,n){if(null==e)return{};var t,a,i={},o=Object.keys(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var l=i.a.createContext({}),c=function(e){var n=i.a.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):s(s({},n),e)),t},d=function(e){var n=c(e.components);return i.a.createElement(l.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return i.a.createElement(i.a.Fragment,{},n)}},b=i.a.forwardRef((function(e,n){var t=e.components,a=e.mdxType,o=e.originalType,r=e.parentName,l=p(e,["components","mdxType","originalType","parentName"]),d=c(t),b=a,m=d["".concat(r,".").concat(b)]||d[b]||u[b]||o;return t?i.a.createElement(m,s(s({ref:n},l),{},{components:t})):i.a.createElement(m,s({ref:n},l))}));function m(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var o=t.length,r=new Array(o);r[0]=b;var s={};for(var p in n)hasOwnProperty.call(n,p)&&(s[p]=n[p]);s.originalType=e,s.mdxType="string"==typeof e?e:a,r[1]=s;for(var l=2;l<o;l++)r[l]=t[l];return i.a.createElement.apply(null,r)}return i.a.createElement.apply(null,t)}b.displayName="MDXCreateElement"}}]);