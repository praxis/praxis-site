<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Praxis Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Praxis Blog Atom Feed"><title data-react-helmet="true">Controllers | Praxis</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Controllers | Praxis"><meta data-react-helmet="true" name="description" content="Controllers are the entrypoint where the implementation to fulfill all API requests live."><meta data-react-helmet="true" property="og:description" content="Controllers are the entrypoint where the implementation to fulfill all API requests live."><meta data-react-helmet="true" property="og:url" content="https://www.praxis-framework.io/docs/reference/implementation/controllers"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://www.praxis-framework.io/docs/reference/implementation/controllers"><link rel="stylesheet" href="/styles.ab2c79ee.css">
<link rel="preload" href="/styles.27a80096.js" as="script">
<link rel="preload" href="/runtime~main.d759ace7.js" as="script">
<link rel="preload" href="/main.0f7e767c.js" as="script">
<link rel="preload" href="/1.1d955ac3.js" as="script">
<link rel="preload" href="/65.fc2dba12.js" as="script">
<link rel="preload" href="/66.81df1f16.js" as="script">
<link rel="preload" href="/935f2afb.f1e5e5bf.js" as="script">
<link rel="preload" href="/64.4c9a6482.js" as="script">
<link rel="preload" href="/3d83026a.9190bee3.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="Praxis Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/logo.png" alt="Praxis Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Praxis</strong></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/gettingStarted/intro">Getting Started</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/reference/intro">Reference</a><a href="https://github.com/praxis/praxis" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="Praxis Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/logo.png" alt="Praxis Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Praxis</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/gettingStarted/intro">Getting Started</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/reference/intro">Reference</a></li><li class="menu__list-item"><a href="https://github.com/praxis/praxis" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><div class="docSidebarContainer_3Ak5" role="complementary"><div class="sidebar_3gvy"><div class="menu menu--responsive thin-scrollbar menu_1yIk"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_1CUI" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Intro</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/intro/intro">Intro</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/intro/installation">Installation</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Getting Started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/gettingStarted/intro">Intro</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/gettingStarted/designingApiResources">Designing our API resources</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/gettingStarted/settingUpOurDB">Setting Up Our Database</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/gettingStarted/implementingReads">Implementing Reads</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/gettingStarted/buildingCRUD">Building CRUD</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Reference</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/intro">Introduction</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Design</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/reference/design/media-types">Media Types</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/reference/design/endpoints">Endpoints</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/reference/design/actions">Actions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/reference/design/api-definition">General API Definitions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/reference/design/response-definitions">Responses</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/reference/design/traits">Traits</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/reference/design/doc-generation">Document Generation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/reference/design/multipart">Multipart</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!" tabindex="0">Implementation</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/reference/implementation/controllers">Controllers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/implementation/application">Application</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/implementation/responses">Responses</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/implementation/request-life-cycle">Request Life Cycle</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/implementation/multipart">Multipart Types</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Extensions</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/reference/extensions/intro">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/reference/extensions/mapper-plugin">Mapper Plugin</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/reference/extensions/pagination-plugin">Pagination Plugin</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/reference/extensions/field-selection">Field Selection</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/reference/extensions/filtering">Filtering</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/reference/extensions/rendering">Rendering</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Internals</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/reference/internals/intro">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/reference/internals/field_selection">FieldSelection</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/reference/internals/field_expansion">FieldExpansion</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/reference/internals/mapper_selectors">MapperSelectors</a></li></ul></li></ul></li></ul></div><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_2WRA"><svg width="20" height="20" role="img" class="collapseSidebarButtonIcon_CoMu"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">Controllers</h1></header><div class="markdown"><p>Controllers are the entrypoint where the implementation to fulfill all API requests live.
They behave much in the same as they do in other MVC-based web frameworks - they implement the actions that receive requests from API clients, operate on the underlying resources to service those requests, and return the
appropriate responses. In short, controllers are the glue which connects actions and their responses to application business logic.</p><p>Praxis controllers differ from some other frameworks in that they:</p><ul><li>are plain Ruby classes that happen to include the <code>Praxis::Controller</code> module. By using plain Ruby classes, Praxis allows you to use the full power of Ruby. You are not limited in your inheritance options, and your controller code can be well-isolated and easily tested.</li><li>serve actions by implementing an instance method with the same name as the action in your endpoint, which accept Ruby <strong>keyword</strong> parameters corresponding to the attribute names of the action definition. Exposing the common parameters as keword method arguments, make your code and interface cleaner, and connects to the API definition in a more direct way.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="including-the-controller-concern"></a>Including the Controller concern<a class="hash-link" href="#including-the-controller-concern" title="Direct link to heading">#</a></h2><p>To implement a controller in Praxis, include the <code>Praxis::Controller</code> module in your controller class and indicate which of your Resource Definitions it implements by using the <code>implements</code> stanza. For example, this could be how you create rthe Post controller class, which will serve the implementation of all actions defined in <code>Endpoints::Posts</code>:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-ruby codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">class Posts</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  include Praxis::Controller</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  implements Endpoints::Posts</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  # Controller code...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Including the <code>Praxis::Controller</code> module enhances the class with important methods such as <code>implements</code>, lifecycle methods (i.e.,<code>before</code>, <code>around</code> <code>after</code>), <code>request</code> to retrieve the incoming API request object, and <code>response</code> for using the default response object when needed.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="linking-to-the-endpoint-definition"></a>Linking to the Endpoint Definition<a class="hash-link" href="#linking-to-the-endpoint-definition" title="Direct link to heading">#</a></h2><p>The <code>implements</code> method is used to connect a controller with its corresponding EndpointDefinition. Technically speaking there is nothing that prevents having the Endpoint definition from also being a controller (i.e., implementing itself). However, and despite that being feasible due to the modularity that Praxis provides, we highly discourage it in order to keep &quot;design&quot; logically separate from &quot;implementation&quot;.</p><p>Once the controller is linked, you can also get to its corresponding <code>EndpointDefinition</code> object through the <code>definition</code> method, which is defined on both the class and instance.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="implementing-an-action"></a>Implementing an Action<a class="hash-link" href="#implementing-an-action" title="Direct link to heading">#</a></h2><p>A controller action is an instance method defined on a controller class. The method&#x27;s name must match an action defined in the controller&#x27;s resource definition. And its keyword arguments must match the defined parameters in the action.</p><p>For example, on the design side, we can have an endpoint definition class for <code>Posts</code> that defines two actions: <code>:index</code> and <code>:show</code>:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-ruby codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">class Endpoints::Posts</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  include Praxis::EndpointDefinition</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  media_type Post</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  version &#x27;1.0&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  action :index do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    routing { get &#x27;&#x27; }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    description &#x27;Fetch all blog posts&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  action :show do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    routing { get &#x27;/:id&#x27; }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    description &#x27;Fetch an individual blog post&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    params do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      attribute :id, Integer, required: true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      attribute :token, String, required: true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      attribute :allow_deleted, Attributor::Boolean</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      attribute :extended_info, Attributor::Boolean</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>The controller implementing this resource definition must have instance methods named <code>index</code> and <code>show</code> must which accept the argument names described by the params block from the resource definition.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-ruby codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">class Posts</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  include Praxis::Controller</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  implements Endpoints::Posts</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  def index</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    # empty method signature: the index action defines no parameters</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  def show(id:, token:, **other_params)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    # four parameters defined matching the names of the arguments</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    # Note that ruby allows is to unpack only the names we care about</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    # and leave the rest tucked away in the other_params hash</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Note that the <code>index</code> action has no parameters defined in its endpoint definition so the method accepts no arguments.</p><p>On the other hand, the <code>show</code> action has four parameters defined in its endpoint, so it can explicitly declare them as named method arguments. Ruby gives you great flexibility in declaring named parameters with the splat operator. It is up to the developer to choose how many explicit arguments to list, and how many to tuck away inside an <code>other_params</code> hash. In
this case, the developer decided that <code>id</code> and <code>token</code> are important enough to use as direct variables in the controller (it is common to only explicitly list the required ones), while pushing the <code>allowed_deleted</code> and <code>extended_info</code> into the other_params hash. Having this flexibility is great for dealing with large number of parameters while keeping your controller code tidy.</p><p>In addition to using named arguments for incoming parameters, Praxis will also ensure their values match the types that you&#x27;ve specified in the Endpoint Definition. So in this case, you can rest assured that accessing the <code>id</code> variable within the <code>show</code> method will always get you an Integer. In other words, there should be no type and parameter validation being done in your controller, because Praxis ensures that if the code makes it to your action, the parameters (and headers and payloads) will properly be there if they are required, and will have been successfully coerced to the defined types.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="retrieving-headers-and-payload-data"></a>Retrieving Headers and Payload Data<a class="hash-link" href="#retrieving-headers-and-payload-data" title="Direct link to heading">#</a></h2><p>While pure path and query string parameters are conveniently exposed as keyword arguments to the function. They are also accessible from inside the <code>request</code> method in the controller (which is provided by the <code>Praxis::Controller</code> include).</p><p>In fact, you can not only get to the params structure by accessing <code>request.params</code>, but you can also use the same technique to access the incoming API payload by <code>request.payload</code> and the incoming headers by <code>request.headers</code>. The data retrieved under these methods is type-curated exactly like keyword arguments and is accessible through calling method names matching your attributes. For example, I can access the same exact <code>token</code> query string parameter by calling <code>request.params.token</code>, or retrieve a hypothetical <code>first_name</code> parameter coming from the API payload of a request by <code>request.payload.first_name</code>.</p><p>Note that <code>request.headers</code> will only give you the (coreced and validated) headers that you have defined. That is not the function to retrieve all the raw headers that the request carries. The rationale here is that if there are important headers that you&#x27;re expecting to use in the action, you should probably have defined them in your API endpoint, as that&#x27;s probably an important information for the API clients to know. For special circumstances, however, you can always access the raw Rack env (which contains the headers) by <code>request.env</code>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="nil-vs-not-provided-values"></a>Nil vs not-provided values<a class="hash-link" href="#nil-vs-not-provided-values" title="Direct link to heading">#</a></h2><p>Using these Struct-type parameters, you can also test if an incoming value was provided by the client (or has been assigned by a <code>default</code> option). To do so, just use the <code>key?</code> method passing the attribute name. This is useful in those cases where there is an important distinction between a user-provided <code>nil</code> value and the user simply not providing a value, as there is in &quot;PATCH&quot; requests. </p><p>Here&#x27;s a simple made up example of how to access these methods from a controller action:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-ruby codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">def update(id:,**other_params)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  id == request.params.id             # id argument will be the same as request.params.id</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  accept = request.headers.accept     # Retrieve &#x27;Accept&#x27; header</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  if request.payload.key?(:email)     # the email attribute was passed (which could be nil)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    email = request.payload.email</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    email ? update_email(email) : reset_email   # Update or reset the email</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  else</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    # Leave email untouched    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="returning-a-response"></a>Returning a Response<a class="hash-link" href="#returning-a-response" title="Direct link to heading">#</a></h2><p>The final piece of every controller action ia to return a Response object with the right headers, status code and body. To do so, you literally <code>return</code> an instance of a Praxis::Response-derived class from the action, and let Praxis worry about formatting and sending those bits back to the API client.</p><p>For every existing HTTP response code, Praxis has an appropriate Response class for you to use. They are all defined under the <code>Praxis::Responses</code> module, using a camel-case named class based on their human http code message. For example, to return a <code>204 No Content</code> HTTP response, you can simply create and return a <code>NoContent</code> class instance in this way:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-ruby codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"> return Praxis::Responses::NoContent.new</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>These response classes also allow configuration as a way to pass the response payload and its headers. They can be configured on instantiation (by pasing arguments to the controller), or as method calls on the created instance.</p><p>Here&#x27;s an example of how you can create a <code>201 Created</code> response, with a <code>Location</code> header of <code>/users/23</code>, and a customer header of <code>X-My-Header</code> with value <code>foo</code>. This is done through setting things on the instance:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-ruby codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">response = Praxis::Responses::Created.new</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">response.headers = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &#x27;Location&#x27; =&gt; &#x27;/users/23&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &#x27;X-My-Header&#x27; =&gt; &#x27;foo&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">return response </span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>And this is the equivalent in doing it through instantiation:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-ruby codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"> return Praxis::Responses::Created.new(location: &#x27;/users/23&#x27;, headers: {`X-My-Header` =&gt; `foo` })</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>You are probably wondering why didn&#x27;t we pass the location through a straight <code>Location</code> header. The answer is that we could have, without problems. We just wanted to illustrate, that since it is so common, we&#x27;ve also allowed you to use the <code>location:</code> parameter to achieve the same. And, in fact, the same is true for a <code>media_type:</code> parameter as well, which would be translated to the appropriate <code>Content-Type</code> parameter of the passed in <code>MediaType</code> object.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="default-response-object"></a>Default response object<a class="hash-link" href="#default-response-object" title="Direct link to heading">#</a></h3><p>Many of your API actions are likely return a <code>200 Ok</code>, at least for the normal execution path. To make things easier keep your controller DRY, Praxis will alway have an instance of a <code>200 Ok</code> response ready for you in your action. You can access it through the <code>response</code> method, and you can easily change it by setting a different instance of a response at any point in time. Using the precreated response, you can keep your code DRY by not having to create a new one every time you return a 200. Note that this is just a convenience to avoid creating instances for all of the common cases, but in fact, you don&#x27;t even have to use that response instance at all if you don&#x27;t want to, as you can always return any response you create from your action.</p><p>Here&#x27;s an example of one way to use and return the default response:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-ruby codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">def show(id:, **other_params)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  response.headers[&#x27;Content-Type&#x27;] = &#x27;text/plain&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  response.body = &quot;This is a simple body&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  response</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="strings-as-responses"></a>Strings as responses<a class="hash-link" href="#strings-as-responses" title="Direct link to heading">#</a></h3><p>While returning a Response instance from your action is the normal flow, there is also another way. In particular, you can instead return a simple string, and if you do so, Praxis take it as the body to send back to the client, and will make use of the current contents of the <code>response</code> method to complete it. In other words, a string return will tell Praxis that you want to use the current contents of the <code>response</code> object, with the passed string as the body. The <code>response</code> method could be the default <code>200</code> instance set by Praxis itself, or could be that you have set it to something else. The final result will set the body of that request to the string returned, and sent that request back to the client. Here&#x27;s a typical example:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-ruby codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">def show(id:, token:, **other_params)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  response.headers[&#x27;Content-Type&#x27;] = &#x27;application/json&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &#x27;{ &quot;first_name&quot; : &quot;Joe&quot;, &quot;email&quot; : &quot;joe@example.com&quot; }&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>...which essentially results in 1) <code>response.body = &lt;STR&gt;</code> and return <code>response</code></p><p>Any returned value from an action that it is not a Response instance or a String is an immediate error.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="request-life-cycle-callbacks"></a>Request Life Cycle Callbacks<a class="hash-link" href="#request-life-cycle-callbacks" title="Direct link to heading">#</a></h2><p>Including the <code>Praxis::Controller</code> module also provides a way to register one or more callbacks to be executed during the request life cycle. This is done using the <code>before</code>, <code>after</code> and <code>around</code> methods which take zero or more params and a block for Praxis to execute.</p><p>For example, to execute a callback before the <code>show</code> action runs, you can add:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-ruby codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">before actions: [:show] do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  puts &quot;before action&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>To execute a callback before the <code>validate</code> stage of the request cycle, but
only when the action is <code>index</code>, you could add:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-ruby codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">before :validate, actions: [:index] do |controller|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  puts &quot;About to validate params/headers/payload for action:&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  puts &quot;#{controller.request.action.name}&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>The block receives the instance of your controller, which you can use to access
all of the controller&#x27;s properties, including the request, the response, any
actions, etc.</p><p>Any of these callbacks are able to interrupt (i.e., shortcut) the execution block of a request by returning an Response instance. For a complete discussion of what stages are available for use in your callbacks, as well as how to use them, please refer to the <a href="/docs/reference/implementation/.request-life-cycle">Request LifeCycle</a> documentation.</p></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/reference/design/multipart"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Multipart</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/reference/implementation/application"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Application Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#including-the-controller-concern" class="table-of-contents__link">Including the Controller concern</a></li><li><a href="#linking-to-the-endpoint-definition" class="table-of-contents__link">Linking to the Endpoint Definition</a></li><li><a href="#implementing-an-action" class="table-of-contents__link">Implementing an Action</a></li><li><a href="#retrieving-headers-and-payload-data" class="table-of-contents__link">Retrieving Headers and Payload Data</a></li><li><a href="#nil-vs-not-provided-values" class="table-of-contents__link">Nil vs not-provided values</a></li><li><a href="#returning-a-response" class="table-of-contents__link">Returning a Response</a><ul><li><a href="#default-response-object" class="table-of-contents__link">Default response object</a></li><li><a href="#strings-as-responses" class="table-of-contents__link">Strings as responses</a></li></ul></li><li><a href="#request-life-cycle-callbacks" class="table-of-contents__link">Request Life Cycle Callbacks</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow</a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog/">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/styles.27a80096.js"></script>
<script src="/runtime~main.d759ace7.js"></script>
<script src="/main.0f7e767c.js"></script>
<script src="/1.1d955ac3.js"></script>
<script src="/65.fc2dba12.js"></script>
<script src="/66.81df1f16.js"></script>
<script src="/935f2afb.f1e5e5bf.js"></script>
<script src="/64.4c9a6482.js"></script>
<script src="/3d83026a.9190bee3.js"></script>
</body>
</html>