<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-reference/implementation/request-life-cycle">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">Request Life Cycle | Praxis</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://site.praxis-framework.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://site.praxis-framework.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://site.praxis-framework.io/docs/reference/implementation/request-life-cycle"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Request Life Cycle | Praxis"><meta data-rh="true" name="description" content="Praxis processes each incoming request by funneling them through a pipeline of stages. Stages are execution points during the servicing of a request, which could themselves contain a set of sub-stages. Each registered stage has a unique name and is connected to the other stages in a well-known order."><meta data-rh="true" property="og:description" content="Praxis processes each incoming request by funneling them through a pipeline of stages. Stages are execution points during the servicing of a request, which could themselves contain a set of sub-stages. Each registered stage has a unique name and is connected to the other stages in a well-known order."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://site.praxis-framework.io/docs/reference/implementation/request-life-cycle"><link data-rh="true" rel="alternate" href="https://site.praxis-framework.io/docs/reference/implementation/request-life-cycle" hreflang="en"><link data-rh="true" rel="alternate" href="https://site.praxis-framework.io/docs/reference/implementation/request-life-cycle" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Praxis RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Praxis Atom Feed"><link rel="stylesheet" href="/assets/css/styles.8a624543.css">
<link rel="preload" href="/assets/js/runtime~main.b9e58ed4.js" as="script">
<link rel="preload" href="/assets/js/main.532c37ff.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="Praxis Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.png" alt="Praxis Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Praxis</b></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/gettingStarted/intro">Getting Started</a><a href="https://github.com/praxis/praxis" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/gettingStarted/intro">Getting Started</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/reference/intro">Reference</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/intro">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/reference/design/media-types">Design</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/docs/reference/implementation/controllers">Implementation</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/implementation/controllers">Controllers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/implementation/resources">Resources</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/implementation/application">Application</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/implementation/responses">Responses</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/reference/implementation/request-life-cycle">Request Life Cycle</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/implementation/multipart">Multipart Types</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/reference/extensions/intro">Extensions</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/reference/internals/intro">Internals</a></div></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Reference</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Implementation</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Request Life Cycle</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Request Life Cycle</h1></header><p>Praxis processes each incoming request by funneling them through a pipeline of stages. Stages are execution points during the servicing of a request, which could themselves contain a set of sub-stages. Each registered stage has a unique name and is connected to the other stages in a well-known order.</p><p>Praxis allows applications to &#x27;hook into&#x27; any of those existing stages through <code>before</code>, <code>after</code> and <code>around</code> callbacks and provides facilities to create or alter the pipeline. Any stage or its hooks are able to abort the pipeline processing early, and shortcut directly to sending a response to the client. A callback can indicate such shortcut by simply returning a <code>Praxis::Request</code> object. Note that when a callback does that, any other further callbacks are not going to be invoked.</p><p>Note: while stages in the request lifecycle might behave similarly to bootstrap stages (as described <a href="/docs/reference/internals/bootstrapping">here</a>), they perform a different role. Request life cycle stages define the processing path for every incoming request, while bootstrapping stages define the execution order when the application first boots.</p><p>Praxis comes out of the box with the following pipeline of stages for any incoming request:</p><p>![Request Life Cycle Diagram]<!-- -->({{ site.baseurl }}/public/images/praxis_request_life_cycle_diagram.png)</p><p>The first of these stages in the pipeline will start after the routing has been processed for the incoming request and the appropriate controller and action has
been identified. This means that currently, there is no way to affect the request routing dynamically.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="request-loading-stage-load_request">Request Loading Stage (<code>:load_request</code>)<a href="#request-loading-stage-load_request" class="hash-link" aria-label="Direct link to request-loading-stage-load_request" title="Direct link to request-loading-stage-load_request">​</a></h2><p>The request loading stage is used to retrieve all the necessary information from the incoming HTTP request so that it is ready for processing.</p><p>This involves:</p><ul><li>parsing the parameters from the URI captures</li><li>retrieving any parameters from query string</li><li>retrieving the paylod contents</li><li>retrieving the incoming headers</li></ul><p>All of these are done, without performing any parsing or type coercion: simply gathering the low-level arguments in one place.</p><p>Note: Strictly speaking retrieving the query string params involves some form-encoding parsing, but it still does not involve any type coercion.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="validation-stage-validate">Validation Stage (<code>:validate</code>)<a href="#validation-stage-validate" class="hash-link" aria-label="Direct link to validation-stage-validate" title="Direct link to validation-stage-validate">​</a></h2><p>During the Validate stage, Praxis will gather the raw data retrieved from the loading stage and will:</p><ul><li>load them into (read: coerce if necessary) into the proper structures as defined in your endpoint definitions for the action that this request is serving.</li><li>validate these created objects based on the requirements set forth by the endpoint definitions.</li></ul><p>These two tasks are done for data corresponding to headers, parameters and payload. In practice, this will result in creating the appropriate <code>headers</code>, <code>params</code> and <code>payload</code> objects accessible through the <code>request</code> object in the controller. Any errors while loading the data into the right types, or validating
their integrity will cause Praxis to abort the pipeline (by shortcutting to the  <code>:response</code> stage) and immediately return an error to the end user indicating the exact
problem (or problems) that were encountered about the incoming data.</p><p>The Validation stage is further composed of two sub-stages.</p><ul><li><code>:headers_and_params</code> : First, this stage will load the headers and the parameters. If all loaded fine they will both be validated in the same order.</li><li><code>:payload</code> : Then this stage will load the incoming payload and then validate its integrity after that.</li></ul><p>Splitting it is these sub-stages it allows enough flexibility to hook into the desired step.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="action-stageaction">Action stage(<code>:action</code>)<a href="#action-stageaction" class="hash-link" aria-label="Direct link to action-stageaction" title="Direct link to action-stageaction">​</a></h2><p>Once the incoming request has been loaded and validated, the next step is to deliver it to the controller action that will service it. At this point Praxis has created a <code>Praxis::Request</code> instance, and made it available to the controller through the <code>request</code> method. This object will have the <code>headers</code>, <code>params</code> and <code>payload</code> methods, which will return the appropriately loaded and validated objects, as defined in your endpoints. The same <code>params</code> attributes will also be splatted into keyword arguments of your controller action.</p><p>The request enters the Action stage at the point when the controller action is invoked. This is the stage where the application will do its logic. Note that your controller only gets invoked if the validation stage succeeds. Therefore, your action should never validate any of the <code>params</code>, <code>headers</code> or <code>payload</code> in its code as they are guaranteed to match all of the requirements of your definition.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="response-stage-response">Response Stage (<code>:response</code>)<a href="#response-stage-response" class="hash-link" aria-label="Direct link to response-stage-response" title="Direct link to response-stage-response">​</a></h2><p>The Response stage is going to <em>always</em> be invoked, even when any of the previous pipeline stages have decided to shortcut the cycle. This is done to give the application
a chance to catch and possibly modify the logic involved in returning the response to the user, even when it is an error response. In the normal, non-error case however, the Response stage is entered when the control returns from the controller action stage.</p><p>The responsibility of this stage is to inspect the returned value (usually a response instance) and perform the necessary steps to unpack it and send it back to the client.</p><p>Note that if any of the around, before or after filters in any other stage return a <code>Response</code> objecy, the request pipeline is immediately shortcut to this <code>:response</code> stage. Therefore, you should never assume that your filters will all be invoked by the time the <code>:response</code> stage code starts. For example, if there is a <code>before :action</code>
filter that sets the current user into the request object, do not assume that this user will be correctly set when the response stage executes, as previous <code>before :action</code> filter might have shortcut the cycle first.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="hooking-into-the-request-life-cycle">Hooking Into the Request Life Cycle<a href="#hooking-into-the-request-life-cycle" class="hash-link" aria-label="Direct link to Hooking Into the Request Life Cycle" title="Direct link to Hooking Into the Request Life Cycle">​</a></h2><p>There are three types of hooks you can use to run a block of code during the
life cycle of a request. You can register a callback to be run either <code>before</code>,
<code>after</code> or <code>around</code> any of the available stages.</p><p>Installing callbacks is done directly from your controller. Just use the class
DSL methods <code>before</code>, <code>after</code> or <code>around</code> that comes with the Praxis::Callback
concerns(already included by the Praxis::Controller module). Each of these methods take
the name of the stage to hook into, an optional list of options, and a callback block.</p><p>The name of the stage can be any of the ones described above: <code>:load_request</code>, <code>:validate</code> (including <code>:validate, :headers_and_params</code> or <code>:validate, :payload</code> to tap into a sub-stage only ), <code>:action</code> or <code>:response</code>.</p><p>The only option supported at the time of this writing is <code>:actions</code>, which
allows the caller to restrict the callback to be applied only to a set of named actions.
Passing no <code>actions</code> option is logically equivalent to passing every possible action in
your controller. More options for callbacks might be introduced in the future.</p><p>To install your hook for substages, pass a second argument after the stage name (i.e. <code>after :validate, :payload ...</code> for tapping into the <code>:payload</code> substage of <code>:validation</code>). If you completely omit the stage name, Praxis will default to the <code>action</code> stage because that&#x27;s the most common use case.</p><p>Here are some examples of how to register callbacks:</p><div class="language-ruby codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ruby codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">  before </span><span class="token symbol">:action</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token symbol">actions</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token symbol">:show</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    puts </span><span class="token string-literal string" style="color:rgb(173, 219, 103)">&quot;Will print before invoking the controller method, for show action only&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token keyword" style="color:rgb(127, 219, 202)">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  before actions</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token symbol">:show</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    puts </span><span class="token string-literal string" style="color:rgb(173, 219, 103)">&quot;Omiting the :action parameter!&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    puts </span><span class="token string-literal string" style="color:rgb(173, 219, 103)">&quot;This is equivalent to the callback above&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token keyword" style="color:rgb(127, 219, 202)">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  after </span><span class="token symbol">:validate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token symbol">:payload</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">do</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">|</span><span class="token plain">controller</span><span class="token operator" style="color:rgb(127, 219, 202)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    puts </span><span class="token string-literal string" style="color:rgb(173, 219, 103)">&quot;Will print after validating the payload for any action&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token keyword" style="color:rgb(127, 219, 202)">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  after </span><span class="token symbol">:validate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token symbol">:payload</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token symbol">actions</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token symbol">:create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">do</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">|</span><span class="token plain">controller</span><span class="token operator" style="color:rgb(127, 219, 202)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    puts </span><span class="token string-literal string" style="color:rgb(173, 219, 103)">&quot;Will print after validating the payload for create only&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token keyword" style="color:rgb(127, 219, 202)">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  after </span><span class="token symbol">:validate</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    put </span><span class="token string-literal string" style="color:rgb(173, 219, 103)">&quot;Will print after the headers and payload substages&#x27; after callbacks&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token keyword" style="color:rgb(127, 219, 202)">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  around </span><span class="token symbol">:action</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">do</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">|</span><span class="token plain">controller</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> callee</span><span class="token operator" style="color:rgb(127, 219, 202)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    puts </span><span class="token string-literal string" style="color:rgb(173, 219, 103)">&quot;Before the action is called&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    callee</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">call</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    puts </span><span class="token string-literal string" style="color:rgb(173, 219, 103)">&quot;After the action is called&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token keyword" style="color:rgb(127, 219, 202)">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">end</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Technically speaking there is not much difference between <code>after :validate</code> and <code>before :action</code> since they are subsequent stages. Semantically, however, they are different as all the <code>after :validate</code> callbacks will be executed before any of the <code>before :action</code> ones. So you should really register the callback based on what stage you depend on, and not on neighboring stages. Otherwise, your code might stop functioning when the pipeline order is changed.</p><p>There is, however, an important difference beween an <code>after :action</code> callback, and a <code>before :response</code> one. That is because the <code>:response</code> stage is always invoked regardless of errors in the previous stages. Therefore <code>after :action</code> will be always skipped on previous stage shortcuts, while <code>before :response</code> will always be invoked regardless of shortcuts (assuming that no other <code>before :response</code> callbacks fail before).</p><p>There is currently no mechanism to order the callbacks for a given stage. They will be executed
in the order that they were registered. Also, there is currently no way to install callbacks around the complete request lifecycle, for example, to install an <code>around</code> callback wrapping all of the
individual request stages. Both of these mechanisms can be added if the need arises.
To achieve something similar to a request <code>around</code> filter, use the <a href="/docs/reference/implementation/application">builtin middleware registration</a> that the Application provides</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="shortcutting-the-request-processing">Shortcutting the request processing<a href="#shortcutting-the-request-processing" class="hash-link" aria-label="Direct link to Shortcutting the request processing" title="Direct link to Shortcutting the request processing">​</a></h3><p>Any of the registered callback blocks (or the core stage execution code itself) can return a
<code>Praxis::Response</code> instance to signal the interruption of the request lifecycle processing. Anything else that the block returns (i.e., nil or any other value) will be ignored and assumed that it signals that the processing should continue.</p><p>If a <code>before</code> callback returns a response, the system will immediately stop processing any further
callbacks of any kind, and shortcut the execution to the <code>:response</code> stage. This means that (with
the exception of the <code>:request</code> stage):</p><ul><li>no other <code>before</code> callbacks in the chain will be executed</li><li>none of the <code>around</code> filters will be executed</li><li>the action won&#x27;t be invoked </li><li>none of the <code>after</code> callbacks will be run either</li></ul><p>If an <code>after</code> callback returns a response, no further <code>after</code> callbacks will be executed either.
Also note that the <code>around</code> callbacks are always started in after the <code>before</code> ones, since they wrap the processing of the controller <code>action</code>.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/reference/implementation/responses"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Responses</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/reference/implementation/multipart"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Multipart Types</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#request-loading-stage-load_request" class="table-of-contents__link toc-highlight">Request Loading Stage (<code>:load_request</code>)</a></li><li><a href="#validation-stage-validate" class="table-of-contents__link toc-highlight">Validation Stage (<code>:validate</code>)</a></li><li><a href="#action-stageaction" class="table-of-contents__link toc-highlight">Action stage(<code>:action</code>)</a></li><li><a href="#response-stage-response" class="table-of-contents__link toc-highlight">Response Stage (<code>:response</code>)</a></li><li><a href="#hooking-into-the-request-life-cycle" class="table-of-contents__link toc-highlight">Hooking Into the Request Life Cycle</a><ul><li><a href="#shortcutting-the-request-processing" class="table-of-contents__link toc-highlight">Shortcutting the request processing</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/gettingStarted/intro">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/Reference/intro">API Reference</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://praxis-framework.slack.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/praxis/praxis" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Praxis. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.b9e58ed4.js"></script>
<script src="/assets/js/main.532c37ff.js"></script>
</body>
</html>